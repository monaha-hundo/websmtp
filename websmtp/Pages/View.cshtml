@page
@model MessageViewModel
@{
    Layout = "_LayoutEmpty";
    ViewData["Title"] = "Home page";
}

    <table class="msg-view table table-striped table-bordered">
        <tr>
            <td>Id</td>
            <td>@Model.MsgId</td>
        </tr>
        <tr>
            <td>Received-On</td>
            <td>@Model.Message.ReceivedOn</td>
        </tr>
        <tr>
            <td>From</td>
            <td>@Model.Message.From</td>
        </tr>
        <tr>
            <td>To</td>
            <td>@Model.Message.To</td>
        </tr>
        <tr>
            <td>Subject</td>
            <td>@Model.Message.Subject</td>
        </tr>
        <tr>
            <td>Attachements</td>
            <td>
                @foreach(var attachment in Model.Message.Attachements){
                    <a  class="badge  text-bg-primary"
                    download="@attachment.Filename"
                    href='data:@(Html.Raw(attachment.MimeType+";base64,"+attachment.Content))'>
                    @attachment.Filename</a>
                }
            </td>
        </tr>
        <tr>
            <td>Text-Content</td>
            <td>
                @Model.Message.TextContent
            </td>
        </tr>
        <tr>
            <td>HTML-Content</td>
            <td>
                <button class="btn btn-primary" onclick="showHtmlContent(this)">Show / Hide</button>
                <iframe id="html-content" style="width: 100%; display: none;" src="data:text/html;base64,@Html.Raw(Model.Message.HtmlContent)"></iframe>
            </td>
        </tr>
        <tr>
            <td>Source</td>
            <td>
                <button class="btn btn-primary" onclick="showSource(this)">Show / Hide</button>
                <pre id="source-content" style="display: none; padding: 0; margin: 0;">@Model.Message.Raw</pre>
            </td>
        </tr>
    </table>

<style>
    table.msg-view {
        width: 100%;
    }

    table.msg-view tr td.header {
        max-width: 320px;
    }
</style>

@section Scripts{
    <script>
        function showHtmlContent(el){
            var el = document.getElementById("html-content");
            let isVisible = el.style.display == 'block';
            let visibility = isVisible ? 'none' : 'block';
            el.style.display = visibility;
        }
        function showSource(el){
            var el = document.getElementById("source-content");
            let isVisible = el.style.display == 'block';
            let visibility = isVisible ? 'none' : 'block';
            el.style.display = visibility;
        }
    </script>
    <script>
        setInterval(()=>window.parent.postMessage(`set-size:${document.documentElement.scrollHeight}`, window.location.origin), 100);
    </script>
    <script type="text/javascript">
        window.addEventListener('message', receiveMessage, false);

        function receiveMessage(evt) {
            console.log("Got message: " + JSON.stringify(evt.data) + " from origin: " + evt.origin);
            // Do we trust the sender of this message?
            //if (evt.origin !== "https://localhost:44335") {
            //    return;
            //}

            if (evt.data.type === "frame-resized") {
                document.getElementById("html-content").style.height = evt.data.value + "px";
            }
        }
    </script>
}